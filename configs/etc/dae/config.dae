include {
    config.d/subs.dae
}

global {
    tproxy_port: 12345
    tproxy_port_protect: true
    so_mark_from_dae: 0
    log_level: info
    disable_waiting_network: false
    lan_interface: eth0, docker0, br-5264eedd3b9f
    wan_interface: auto
    auto_config_kernel_parameter: true
    tcp_check_url: 'https://cp.cloudflare.com'
    tcp_check_http_method: HEAD
    udp_check_dns: '8.8.8.8:53'
    check_interval: 120s
    check_tolerance: 200ms
    dial_mode: domain++
    allow_insecure: true
    sniffing_timeout: 5000ms
    tls_implementation: utls
    utls_imitate: chrome_auto
}

# See https://github.com/daeuniverse/dae/blob/main/docs/zh/configuration/dns.md for examples.
dns {
    ipversion_prefer: 4
    upstream {
        alidns: 'udp://114.114.114.114:53'
        googledns: 'tcp://8.8.8.8:53'
    }
    routing {
        request {
            qname(suffix: shakaianee.top) -> alidns
            qname(geosite:cn) -> alidns
            fallback: googledns
        }
    }
}

group {
    sg {
        filter: name(keyword: '新加坡')
        policy: min_avg10
    }
    proxy {
        # filter: subtag(fei) && name(keyword: '新加坡', keyword: '日本')
        # filter: name(keyword: '香港', keyword: '日本', keyword: '台湾', keyword: '韩国')
        # policy: fixed(0)
        filter: subtag(cent)
        filter: subtag(fei) [add_latency: 500ms]
        policy: min_avg10
    }
}

# See https://github.com/daeuniverse/dae/blob/main/docs/zh/configuration/routing.md for examples.
routing {
    mac('b0:25:aa:74:47:8b') -> must_direct
    pname(ssh,iwd,systemd-resolve,systemd-network,systemd-resolved,systemd-networkd) -> must_direct
    l4proto(udp) && dport(443) -> block
    dip(geoip:private) -> direct
    domain(geosite:"category-ads-all") -> block

    # 自定义分流
    pname(ayaping, qbittorrentee, gg, node) -> direct
    # dip(95.216.144.0/24, 47.80.0.4, 220.130.108.125, 43.132.187.10) -> direct # kr ali
    domain(ip.aya1.de,r.aya1.de,aya1.eu.org) -> direct
    domain(
        18comic.vip,
        keyword:jcomic,
        domain:meta,
        domain:github
    ) -> sg
    domain(
        geosite:category-games@cn,
        cdn.nlark.com,
        cdn.onesignal.com,
        decart.ai,
        doubao.com,
        dreamtonics.com.cn,
        ghp.ci,
        hdslb.com,
        oryoy.com,
        solidot.org,
        steamdb.info,
        steamserver.net,
        keyword: syncthing,
        test-ipv6.com,
        zu1k.com
    ) -> direct

    dip(geoip:cn) -> direct
    domain(geosite:cn) -> direct
    fallback: proxy
}
