include {
    config.d/subs.dae
}

global {
    tproxy_port: 12345
    tproxy_port_protect: true
    so_mark_from_dae: 0
    log_level: info
    disable_waiting_network: false
    lan_interface: docker0,enp1s0
    wan_interface: auto
    auto_config_kernel_parameter: true
    tcp_check_url: 'https://cp.cloudflare.com'
    tcp_check_http_method: HEAD
    udp_check_dns: '8.8.8.8:53'
    check_interval: 120s
    check_tolerance: 200ms
    dial_mode: domain++
    allow_insecure: true
    sniffing_timeout: 5000ms
    tls_implementation: utls
    utls_imitate: chrome_auto
}

# See https://github.com/daeuniverse/dae/blob/main/docs/en/configuration/dns.md for full examples.
dns {
    ipversion_prefer: 4
    upstream {
        alidns: 'udp://114.114.114.114:53'
        #alidns: 'udp://114.114.114.114:53'
        googledns: 'tcp://8.8.8.8:53'
    }
    routing {
        request {
            qname(suffix: cip.cc) -> alidns
            qname(geosite:cn) -> alidns
            fallback: googledns
        }
    }
}

group {
#    zhul {
#    	filter: name(zll)
#    	policy: fixed(0)
#    }
    proxy {
#        filter: subtag(fei) && name(keyword: '新加坡', keyword: '日本')
#        filter: name(keyword: '香港', keyword: '日本', keyword: '台湾', keyword: '韩国')
        policy: min_avg10
    }
}

routing {
    pname(systemd-resolved) -> must_direct
    dip(geoip:private) -> direct

    ### 自定义分流
    pname(ayaping, qbittorrentee, gg, node) -> direct
    domain(geosite:"category-ads-all") -> block
    dip(47.80.0.4, 220.130.108.125, 43.132.187.10) -> direct # KR 阿里云
    domain(ip.aya1.de,aya1.eu.org,ayatale.eu.org) -> direct
    domain(akamaihd.net,
           akamaized.net,
           keyword: akamai,
           aliyuncs.com,
           cdn.nlark.com,
           cdn.onesignal.com,
           decart.ai,
           doubao.com,
           dreamtonics.com.cn,
           ghp.ci,
           hdslb.com,
           solidot.org,
           steamdb.info,
           steamserver.net,
           keyword: syncthing,
           test-ipv6.com,
           zu1k.com) -> direct
#    domain(solidot.org) -> proxy
    # l4proto(udp) && dport(443) -> block
    dip(geoip:cn) -> direct
    domain(geosite:cn) -> direct
    fallback: proxy
}
